import "dart:math" as pC;import "dart:html" as EB;import "dart:async" as iB;class mC{final  name;const mC(this.name);}var NB;var FC='';var WB=0;const cB=const Duration(seconds:2);final  GC=17;final  HC=2;final  jB=26;final  kB=10;final  IC=2;final  JC=6;final  KC=5;final  LC=1;final  lB=6;final  mB=4;var i;var qB=false;var XB;var n;var dB=0;var TB=false;var HB;var YB=0;var zB=0;var OB=false;var ZB=false;var QB;var eB;var BB;var IB=new m();var JB=new m();var KB=new m();var LB=new m(); main(){NB='Game started ...';i=new XC();i.aC();i.bC(1,1);MC();} MC(){XB=EB.queryAll('.playable');XB.forEach(( g){g.onClick.listen(( h){NC(g);});});print('Game starting ...');i.w=1;WB++ ;if(i.AB.isIA)rB(i.AB);else{BB=i.AB;NB='Your turn : click on a node to drop an item !';}} NC( g){if(!qB){if(dB==0){if(i.w==1){if(!TB)PC(BB,g);else BC(BB,g);return;}else{if(!TB){if(HB!=null){OC(BB,g);}else{AC(BB,g);}}else BC(BB,g);return;}}else{EB.window.alert('Wait for your turn !');return;}}else return;} OC( h, o){var g=SB(o);if(g.square!=null){if(g.player.number==h.number){AC(h,o);}else if(g.player.number==0){var u=new q(0,SB(HB));u.p=SB(HB);if(h.hB){var l=new q(0,g);l.p=SB(HB);vB(l,h);var k=new q(0,g);if(bB(k,h,true,true)){gB(k.emplacement,true);NB='Mill detected ... You can delete an adversary item !';TB=true;fB();}else{RB();}}else{var t=xB(u,true);if(t.length>0){if(t.contains(g)){var l=new q(0,g);l.p=SB(HB);vB(l,h);var k=new q(0,g);if(bB(k,h,true,true)){gB(k.emplacement,true);NB='Mill detected ... You can delete an adversary item !';TB=true;fB();}else{RB();}}}else{print('No possible moves ...');EB.window.alert('No possible moves ...');}}}else{print('Position is owned by an adversary : impossible move');EB.window.alert('Position is owned by an adversary : impossible move');}}else{print('No position !');EB.window.alert('Erreur !');}} AC( k, g){var h=SB(g);if(h.square!=null){if(h.player.number==k.number){if(HB!=null&&HB.attributes["data-square"]==g.attributes["data-square"]&&HB.attributes["data-value"]==g.attributes["data-value"]){fB();}else{fB();g.classes.add("selected");HB=g;}}}else{print('No position !');EB.window.alert('Erreur !');}} fB(){HB=null;EB.queryAll('.playable').forEach(( g){if(g.classes.contains("selected"))g.classes.remove("selected");});} PC( k, l){var g=SB(l);if(g.square!=null){if(g.player.number==0){tB(g,k);var h=new q(0,g);if(bB(h,k,true,true)){gB(h.emplacement,true);NB='Mill detected ... You can delete an adversary item !';TB=true;}else{RB();}}else{print('Position not empty !');EB.window.alert('Please select an empty position');}}else{print('No position !');EB.window.alert('Erreur !');}} BC( h, k){var g=SB(k);if(g.square!=null){if(g.player.number!=0&&g.player.number!=h.number){if(!g.isMorris){uB(g);TB=false;RB();}else{print('Position is on a mill !');EB.window.alert('That item is on a mill : You can\'t delete it !');QC(h);}}else{print('Position is not an adversary !');EB.window.alert('That position isn\'t an adversary !');}}else{print('No position !');EB.window.alert('Erreur !');}} QC( k){var h=0;for(int g=0;g<i.j.length;g++ ){if(i.j[g].player.number!=k.number&&i.j[g].player.number!=0&&!i.j[g].isMorris)h++ ;}if(h==0){EB.window.alert('There is only mill on the game ... You can\'t delete an item !');TB=false;RB();}return;} RC( g){WB++ ;switch (g.number){case 1:if(i.DB.isIA)rB(i.DB);else BB=i.DB;break;case 2:if(i.AB.isIA)rB(i.AB);else BB=i.AB;break;}return;} rB( g){if(!qB){if(g.number==dB||dB==0){BB=g;var h=new iB.Timer(cB,()=>SC(g));}}return;} SC( g){UC(g);return;} RB(){dB=0;NB='Next gamer will play ...';fB();TC();RC(BB);} TC(){if(zB>GC&&i.w!=2){i.w=2;WB=0;print('Game step 2 enclenched ...');}if(i.w>1){var h=0;var k=0;for(int g=0;g<i.j.length;g++ ){if(i.j[g].player.number==1)h++ ;else if(i.j[g].player.number==2)k++ ;}if(h<3||k<3){sB(false);return;}else if(h<4){i.AB.hB=true;}else if(k<4){i.DB.hB=true;}if(WB>49){sB(false);return;}else if(WB>30){FC="After 50 rounds, the game will be over ! Hurry !";}}} sB( o){qB=true;var g="";var k=0;var l=0;for(int h=0;h<i.j.length;h++ ){if(i.j[h].player.number==1)k++ ;else if(i.j[h].player.number==2)l++ ;}if(k<3){g+= "Game Over !!\n\nPlayer 2 win the game !!";}else if(l<3){g+= "Game Over !!\n\nPlayer 1 win the game !!";}if(WB>49)g+= "Too long game ... \n\nDraw !!!";if(o){g+= "The player "+BB.number.toString()+" can't move !! \n\n He lose the game !";}NB=g;EB.window.alert(g);return;} UC( g){var h=new q();dB=g.number;NB='Player '+g.name+' will playing ... ';if(i.w==1){h=wB(i.s,g,false);tB(h.emplacement,g);}else if(i.w==2){h=wB(g,g,false);vB(h,g);}if(h!=null){if(bB(h,g,true,true)){gB(h.emplacement,true);NB='Mill detected ... We go to delete an item !';switch (g.number){case 1:iB.Timer k=new iB.Timer(cB,()=>DC(i.DB));return;break;case 2:iB.Timer k=new iB.Timer(cB,()=>DC(i.AB));return;break;}}else{var k=new iB.Timer(cB,RB);return;}}else{var k=new iB.Timer(cB,RB);return;}} CC( h){for(int g=0;g<XB.length;g++ ){if(XB[g].attributes["data-square"]==h.square&&XB[g].attributes["data-value"]==h.value.toString()){return XB[g];break;}}} SB( g){return i.j.firstWhere(( h){if(h.square==g.attributes["data-square"]&&h.value.toString()==g.attributes["data-value"]){return true;}else return false;},orElse:(){print('No position founded for the case ...');return new m();});} DC( h){var g=wB(h,h,true);if(g.emplacement!=null){uB(g.emplacement);}else{print('Cannot delete an item : there are only mills !');}RB();} tB( g, h){if(i.w==1)zB++ ;var k=i.j.indexOf(g);var l=CC(g);g.player=h;i.j.removeAt(k);i.j.add(g);if(i.w==1)print('Drop item to : '+g.square+'-'+g.value.toString());l.classes.add(h.name);return;} uB( g){var h=i.j.indexOf(g);var k=CC(g);k.classes.remove(g.player.name);g.player=i.s;i.j.removeAt(h);i.j.add(g);return;} vB( g, h){if(g!=null&&g.p!=null&&g.emplacement!=null){print('Move item from : '+g.p.square+'-'+g.p.value.toString()+' to : '+g.emplacement.square+'-'+g.emplacement.value.toString());var k=new q(0,g.p);if(bB(k,h,true,true)){print('We break a mill ...');gB(k.emplacement,false);}uB(g.p);tB(g.emplacement,h);return;}else{sB(true);return;}} gB( h, k){var g=i.j.indexOf(h);h.isMorris=k;i.j[g]=h;if(IB.player!=null){g=i.j.indexOf(IB);IB.isMorris=k;i.j[g]=IB;}if(JB.player!=null){g=i.j.indexOf(JB);JB.isMorris=k;i.j[g]=JB;}if(KB.player!=null){g=i.j.indexOf(KB);KB.isMorris=k;i.j[g]=KB;}if(LB.player!=null){g=i.j.indexOf(LB);LB.isMorris=k;i.j[g]=LB;}if(KB.player!=null&&LB.player!=null){print('You just make a mill in : '+h.square+'-'+h.value.toString()+' | '+KB.square+'-'+KB.value.toString()+' | '+LB.square+'-'+LB.value.toString());}if(IB.player!=null&&JB.player!=null){print('You just make a mill in : '+h.square+'-'+h.value.toString()+' | '+IB.square+'-'+IB.value.toString()+' | '+JB.square+'-'+JB.value.toString());}} wB( MB, o, PB){ZB=PB;var GB=new q();if(i.w==2&&BB.hB)GB=WC(BB);n=new List<q>();if(i.w==1||ZB){for(int g=0;g<i.j.length;g++ ){if(i.j[g].player.number==MB.number){if(ZB&&i.j[g].isMorris==false){var h=new q(0,i.j[g]);n.add(h);YB=0;OB=false;aB(h,o,true);}else if(!ZB){var h=new q(0,i.j[g]);n.add(h);YB=0;OB=false;aB(h,o,true);}}}}else{for(int g=0;g<i.j.length;g++ ){if(i.w==2&&BB.hB){if(i.j[g].player.number==0){var h=new q(0,i.j[g]);h.p=GB.emplacement;n.add(h);YB=0;OB=false;aB(h,o,true);}}else{if(i.j[g].player.number==MB.number){var CB=new q();CB.emplacement=i.j[g];CB.points=0;var u=xB(CB,true);if(u.length>0){for(var t=0;t<u.length;t++ ){if(u[t].player.number==0){var h=new q(0,u[t]);h.p=i.j[g];n.add(h);YB=0;OB=true;QB=h;aB(h,o,false);}}}}}}}var k=new List<q>();var l=0;for(int g=0;g<n.length;g++ ){if(!ZB){print('Position : '+n[g].emplacement.square+'-'+n[g].emplacement.value.toString()+' | points : '+n[g].points.toString());if(BB.FB==3){if(n[g].points==l){k.add(n[g]);}else if(n[g].points>l){l=n[g].points;k=new List<q>();k.add(n[g]);}}else{k.add(n[g]);}}else{if(n[g].points==l&&!n[g].emplacement.isMorris){k.add(n[g]);}else if(n[g].points>l&&!n[g].emplacement.isMorris){l=n[g].points;k=new List<q>();k.add(n[g]);}}}return EC(k);} EC( g){if(g.length==1)return g[0];else if(g.length==0){print('Unable to delete/move an item !!');return new q();}var k=new pC.Random();for(var h=g.length-1;h>0;h-- ){var l=k.nextInt(g.length);return g[l];}} aB( l, h, k){VC(l,h,k);bB(l,h,false,k);if(OB&&YB<HC){YB++ ;if(eB.length>0){for(int g=0;g<eB.length;g++ ){var o=new q(0,eB[g]);o.p=QB.emplacement;OB=false;aB(o,h,k);OB=true;}}}} VC( l, u, t){var o=xB(l,t);eB=new List<m>();var g=0;for(int k=0;k<o.length;k++ ){g+= LC;if(o[k].player.number==u.number)g+= JC;else if(o[k].player.number==0){g+= IC;eB.add(o[k]);}else g+= KC;}var h;if(!OB){h=n.indexOf(l);l.points+= g;if(h!=-1){n.removeAt(h);n.add(l);}}else{h=n.indexOf(QB);QB.points+= g;if(h!=-1){n.removeAt(h);n.add(QB);}}} xB( h, l){var k=new List<m>();for(int g=0;g<i.j.length;g++ ){if(h.emplacement.square==i.j[g].square){if(oB(h.emplacement.value,1)==i.j[g].value||nB(h.emplacement.value,1)==i.j[g].value){if(i.w==2&&!l){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square){k.add(i.j[g]);}}else{k.add(i.j[g]);}}}if(h.emplacement.value==1||h.emplacement.value==3||h.emplacement.value==5||h.emplacement.value==7){switch (h.emplacement.square){case 'G':if(i.j[g].square=='M'&&i.j[g].value==h.emplacement.value){if(i.w==2&&!l){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square)k.add(i.j[g]);}else{k.add(i.j[g]);}}break;case 'S':if(i.j[g].square=='M'&&i.j[g].value==h.emplacement.value){if(i.w==2&&!l){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square)k.add(i.j[g]);}else{k.add(i.j[g]);}}break;case 'M':if(i.j[g].square!='M'&&i.j[g].value==h.emplacement.value){if(i.w==2&&!l){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square)k.add(i.j[g]);}else{k.add(i.j[g]);}}break;}}}return k;} bB( h, k, VB, GB){var CB=0;var MB=0;var UB=0;var yB=[0,2,4,6];IB=new m();JB=new m();KB=new m();LB=new m();if(yB.contains(h.emplacement.value)){var o=new List<m>();var t=new List<m>();for(int g=0;g<i.j.length;g++ ){if(i.j[g].square==h.emplacement.square&&(oB(h.emplacement.value,1)==i.j[g].value||(oB(h.emplacement.value,2))==i.j[g].value)){if(i.w==2&&!GB){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square)o.add(i.j[g]);}else{o.add(i.j[g]);}}if(i.j[g].square==h.emplacement.square&&(nB(h.emplacement.value,1)==i.j[g].value||(nB(h.emplacement.value,2))==i.j[g].value)){if(i.w==2&&!GB){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square)t.add(i.j[g]);}else{t.add(i.j[g]);}}}if(o.length==2){if(o[0].player.number!=0&&o[0].player.number==o[1].player.number){if(o[0].player.number==k.number){CB+= jB;if(VB){IB=o[0];JB=o[1];return true;}}else{CB+= kB;}}else if(o[0].player.number==k.number||o[1].player.number==k.number){if((o[0].player.number!=0&&o[0].player.number!=k.number)||(o[1].player.number!=0&&o[1].player.number!=k.number))UB+= mB;else MB+= lB;}}if(t.length==2){if(t[0].player.number!=0&&t[0].player.number==t[1].player.number){if(t[0].player.number==k.number){CB+= jB;if(VB){KB=t[0];LB=t[1];return true;}}else{CB+= kB;}}else if(t[0].player.number==k.number||t[1].player.number==k.number){if((t[0].player.number!=k.number&&t[0].player.number!=0)||(t[1].player.number!=k.number&&t[1].player.number!=0))UB+= mB;else MB+= lB;}}}else{var u=new List<m>();var l=new List<m>();for(int g=0;g<i.j.length;g++ ){if(i.j[g].square==h.emplacement.square){if(oB(h.emplacement.value,1)==i.j[g].value||nB(h.emplacement.value,1)==i.j[g].value){if(i.w==2&&!GB){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square)u.add(i.j[g]);}else{u.add(i.j[g]);}}}else{switch (h.emplacement.square){case 'G':if((i.j[g].square=='M'||i.j[g].square=='S')&&i.j[g].value==h.emplacement.value){if(i.w==2&&!GB){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square)l.add(i.j[g]);}else{l.add(i.j[g]);}}break;case 'S':if((i.j[g].square=='M'||i.j[g].square=='G')&&i.j[g].value==h.emplacement.value){if(i.w==2&&!GB){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square)l.add(i.j[g]);}else{l.add(i.j[g]);}}break;case 'M':if((i.j[g].square=='G'||i.j[g].square=='S')&&i.j[g].value==h.emplacement.value){if(i.w==2&&!GB){if(i.j[g].value!=h.p.value||i.j[g].square!=h.p.square)l.add(i.j[g]);}else{l.add(i.j[g]);}}break;}}}if(u.length==2){if(u[0].player.number!=0&&u[0].player.number==u[1].player.number){if(u[0].player.number==k.number){CB+= jB;if(VB){IB=u[0];JB=u[1];return true;}}else{CB+= kB;}}else if(u[0].player.number==k.number||u[1].player.number==k.number){if((u[0].player.number!=k.number&&u[0].player.number!=0)||(u[1].player.number!=k.number&&u[1].player.number!=0))UB+= mB;else MB+= lB;}}if(l.length==2){if(l[0].player.number!=0&&l[0].player.number==l[1].player.number){if(l[0].player.number==k.number){CB+= jB;if(VB){KB=l[0];LB=l[1];return true;}}else{CB+= kB;}}else if(l[0].player.number==k.number||l[1].player.number==k.number){if((l[0].player.number!=0&&l[0].player.number!=k.number)||(l[1].player.number!=0&&l[1].player.number!=k.number))UB+= mB;else MB+= lB;}}}if(!VB){if(!OB){var PB=n.indexOf(h);h.points+= CB;if(ZB){h.points+= MB;h.points-= UB;}if(PB!=-1){n.removeAt(PB);n.add(h);}}else{var PB=n.indexOf(QB);QB.points+= CB;if(PB!=-1){n.removeAt(PB);n.add(QB);}}}else{return false;}} WC( o){n=new List<q>();for(int g=0;g<i.j.length;g++ ){if(i.j[g].player.number==o.number){var l=new q(0,i.j[g]);n.add(l);aB(l,o,true);}}var h=new List<q>();var k=1000;for(int g=0;g<n.length;g++ ){if(BB.FB==3){if(n[g].points==k){h.add(n[g]);}else if(n[g].points<k){k=n[g].points;h=new List<q>();h.add(n[g]);}}else{h.add(n[g]);}}return EC(h);} nB( g, h){if(g==0){return 8-h;}else{return g-h;}} oB( g, h){if(g+h>=8)return 0;else{return g+h;}}class q{var points;var emplacement;var p;q([this.points,this.emplacement]);}class XC{var j;var s;var AB;var DB;var pB;var w;var FB; aC(){ZC();YC();} YC(){var o=new m(0,"G",s,false);var cC=new m(1,"G",s,false);var dC=new m(2,"G",s,false);var eC=new m(3,"G",s,false);var k=new m(4,"G",s,false);var GB=new m(5,"G",s,false);var PB=new m(6,"G",s,false);var g=new m(7,"G",s,false);var UB=new m(0,"M",s,false);var VB=new m(1,"M",s,false);var h=new m(2,"M",s,false);var fC=new m(3,"M",s,false);var gC=new m(4,"M",s,false);var l=new m(5,"M",s,false);var t=new m(6,"M",s,false);var yB=new m(7,"M",s,false);var hC=new m(0,"S",s,false);var u=new m(1,"S",s,false);var iC=new m(2,"S",s,false);var MB=new m(3,"S",s,false);var CB=new m(4,"S",s,false);var jC=new m(5,"S",s,false);var kC=new m(6,"S",s,false);var lC=new m(7,"S",s,false);j=new List<m>();j.add(o);j.add(cC);j.add(dC);j.add(eC);j.add(k);j.add(GB);j.add(PB);j.add(g);j.add(UB);j.add(VB);j.add(h);j.add(fC);j.add(gC);j.add(l);j.add(t);j.add(yB);j.add(hC);j.add(u);j.add(iC);j.add(MB);j.add(CB);j.add(jC);j.add(kC);j.add(lC);} ZC(){s=new v(0,true,"neutral");AB=new v(1,true,"khaleesi");DB=new v(2,true,"snow");} bC( g, h){FB=h;print('--------------------------------');if(g==1){AB.isIA=true;AB.FB=3;DB.isIA=true;DB.FB=1;pB=1;print('IA lvl 3 vs IA lvl 1');}else if(g==2){AB.isIA=false;AB.FB=3;DB.isIA=true;DB.FB=3;pB=2;print('Player vs IA lvl 3');}else if(g==3){AB.isIA=false;AB.FB=3;DB.isIA=true;DB.FB=1;pB=3;print('Player vs IA lvl 1');}else{AB.isIA=false;AB.FB=3;DB.isIA=false;DB.FB=3;pB=3;print('Player vs Player');}print('--------------------------------');}}class v{var number;var isIA;var name;var FB=3;var hB=false;v([this.number,this.isIA,this.name]);}class m{var player;var square;var value;var isMorris;m([this.value,this.square,this.player,this.isMorris]);}const nC=const oC();class oC{const oC();}