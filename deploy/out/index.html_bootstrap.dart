import "dart:isolate" as RE;import "dart:html" as KB;import "dart:async" as zB;import "dart:collection" as lC;import "dart:math" as SE;class FE{static const  GE="Chrome";final  pD;final  minimumVersion;const FE(this.pD,[this.minimumVersion]);}class HE{final  name;const HE(this.name);}class t{var points;var emplacement;var s;t([this.points,this.emplacement]);}class xC{var k;var u;var BB;var GB;var JC;var w;var MB; sD(){rD();qD();} qD(){var m=new n(0,"G",u,false);var vD=new n(1,"G",u,false);var wD=new n(2,"G",u,false);var xD=new n(3,"G",u,false);var i=new n(4,"G",u,false);var DB=new n(5,"G",u,false);var SB=new n(6,"G",u,false);var g=new n(7,"G",u,false);var eB=new n(0,"M",u,false);var fB=new n(1,"M",u,false);var h=new n(2,"M",u,false);var yD=new n(3,"M",u,false);var zD=new n(4,"M",u,false);var l=new n(5,"M",u,false);var q=new n(6,"M",u,false);var kC=new n(7,"M",u,false);var AE=new n(0,"S",u,false);var p=new n(1,"S",u,false);var BE=new n(2,"S",u,false);var HB=new n(3,"S",u,false);var AB=new n(4,"S",u,false);var CE=new n(5,"S",u,false);var DE=new n(6,"S",u,false);var EE=new n(7,"S",u,false);k=new List<n>();k.add(m);k.add(vD);k.add(wD);k.add(xD);k.add(i);k.add(DB);k.add(SB);k.add(g);k.add(eB);k.add(fB);k.add(h);k.add(yD);k.add(zD);k.add(l);k.add(q);k.add(kC);k.add(AE);k.add(p);k.add(BE);k.add(HB);k.add(AB);k.add(CE);k.add(DE);k.add(EE);} rD(){u=new v(0,true,"neutral");BB=new v(1,true,"khaleesi");GB=new v(2,true,"snow");} uD( g, h){MB=h;print('--------------------------------');if(g==1){BB.isIA=true;BB.MB=3;GB.isIA=true;GB.MB=1;JC=1;print('IA lvl 3 vs IA lvl 1');}else if(g==2){BB.isIA=false;BB.MB=3;GB.isIA=true;GB.MB=3;JC=2;print('Player vs IA lvl 3');}else if(g==3){BB.isIA=false;BB.MB=3;GB.isIA=true;GB.MB=1;JC=3;print('Player vs IA lvl 1');}else{BB.isIA=false;BB.MB=3;GB.isIA=false;GB.MB=3;JC=3;print('Player vs Player');}print('--------------------------------');}}class v{var number;var isIA;var name;var MB=3;var yB=false;v([this.number,this.isIA,this.name]);}class n{var player;var square;var value;var isMorris;n([this.value,this.square,this.player,this.isMorris]);}main(){vC=true;FD();RD();}final TB=new EB();var LC; get UB{if(ZC){aC(TB,LB.bB,'message');}return LC;}set UB( g){if(YC(TB)){bC(TB,LB.bB,'message',LC,g);}LC=g;}var MC=''; get yC{if(ZC){aC(TB,LB.bB,'carefullMessage');}return MC;}set yC( g){if(YC(TB)){bC(TB,LB.bB,'carefullMessage',MC,g);}MC=g;}var NC=0; get AC{if(ZC){aC(TB,LB.bB,'round');}return NC;}set AC( g){if(YC(TB)){bC(TB,LB.bB,'round',NC,g);}NC=g;}const pB=const Duration(seconds:2);final  zC=17;final  AD=2;final  BC=26;final  CC=10;final  BD=2;final  CD=6;final  DD=5;final  ED=1;final  DC=6;final  EC=4;var j;var OC=false;var gB;var o;var qB=0;var aB=false;var NB;var hB=0;var mC=0;var VB=false;var iB=false;var XB;var rB;var CB;var OB=new n();var PB=new n();var QB=new n();var RB=new n(); FD(){UB='Game started ...';j=new xC();j.sD();j.uD(1,1);GD();} GD(){gB=KB.queryAll('.playable');gB.forEach(( g){g.onClick.listen(( h){HD(g);});});print('Game starting ...');j.w=1;AC++ ;if(j.BB.isIA)PC(j.BB);else{CB=j.BB;UB='Your turn : click on a node to drop an item !';}} HD( g){if(!OC){if(qB==0){if(j.w==1){if(!aB)JD(CB,g);else oC(CB,g);return;}else{if(!aB){if(NB!=null){ID(CB,g);}else{nC(CB,g);}}else oC(CB,g);return;}}else{KB.window.alert('Wait for your turn !');return;}}else return;} ID( h, m){var g=ZB(m);if(g.square!=null){if(g.player.number==h.number){nC(h,m);}else if(g.player.number==0){var p=new t(0,ZB(NB));p.s=ZB(NB);if(h.yB){var l=new t(0,g);l.s=ZB(NB);TC(l,h);var i=new t(0,g);if(kB(i,h,true,true)){tB(i.emplacement,true);UB='Mill detected ... You can delete an adversary item !';aB=true;sB();}else{YB();}}else{var q=VC(p,true);if(q.length>0){if(q.contains(g)){var l=new t(0,g);l.s=ZB(NB);TC(l,h);var i=new t(0,g);if(kB(i,h,true,true)){tB(i.emplacement,true);UB='Mill detected ... You can delete an adversary item !';aB=true;sB();}else{YB();}}}else{print('No possible moves ...');KB.window.alert('No possible moves ...');}}}else{print('Position is owned by an adversary : impossible move');KB.window.alert('Position is owned by an adversary : impossible move');}}else{print('No position !');KB.window.alert('Erreur !');}} nC( i, g){var h=ZB(g);if(h.square!=null){if(h.player.number==i.number){if(NB!=null&&NB.attributes["data-square"]==g.attributes["data-square"]&&NB.attributes["data-value"]==g.attributes["data-value"]){sB();}else{sB();g.classes.add("selected");NB=g;}}}else{print('No position !');KB.window.alert('Erreur !');}} sB(){NB=null;KB.queryAll('.playable').forEach(( g){if(g.classes.contains("selected"))g.classes.remove("selected");});} JD( i, l){var g=ZB(l);if(g.square!=null){if(g.player.number==0){RC(g,i);var h=new t(0,g);if(kB(h,i,true,true)){tB(h.emplacement,true);UB='Mill detected ... You can delete an adversary item !';aB=true;}else{YB();}}else{print('Position not empty !');KB.window.alert('Please select an empty position');}}else{print('No position !');KB.window.alert('Erreur !');}} oC( h, i){var g=ZB(i);if(g.square!=null){if(g.player.number!=0&&g.player.number!=h.number){if(!g.isMorris){SC(g);aB=false;YB();}else{print('Position is on a mill !');KB.window.alert('That item is on a mill : You can\'t delete it !');KD(h);}}else{print('Position is not an adversary !');KB.window.alert('That position isn\'t an adversary !');}}else{print('No position !');KB.window.alert('Erreur !');}} KD( i){var h=0;for(int g=0;g<j.k.length;g++ ){if(j.k[g].player.number!=i.number&&j.k[g].player.number!=0&&!j.k[g].isMorris)h++ ;}if(h==0){KB.window.alert('There is only mill on the game ... You can\'t delete an item !');aB=false;YB();}return;} LD( g){AC++ ;switch (g.number){case 1:if(j.GB.isIA)PC(j.GB);else CB=j.GB;break;case 2:if(j.BB.isIA)PC(j.BB);else CB=j.BB;break;}return;} PC( g){if(!OC){if(g.number==qB||qB==0){CB=g;var h=new zB.Timer(pB,()=>MD(g));}}return;} MD( g){OD(g);return;} YB(){qB=0;UB='Next gamer will play ...';sB();ND();LD(CB);} ND(){if(mC>zC&&j.w!=2){j.w=2;AC=0;print('Game step 2 enclenched ...');}if(j.w>1){var h=0;var i=0;for(int g=0;g<j.k.length;g++ ){if(j.k[g].player.number==1)h++ ;else if(j.k[g].player.number==2)i++ ;}if(h<3||i<3){QC(false);return;}else if(h<4){j.BB.yB=true;}else if(i<4){j.GB.yB=true;}if(AC>49){QC(false);return;}else if(AC>30){yC="After 50 rounds, the game will be over ! Hurry !";}}} QC( m){OC=true;var g="";var i=0;var l=0;for(int h=0;h<j.k.length;h++ ){if(j.k[h].player.number==1)i++ ;else if(j.k[h].player.number==2)l++ ;}if(i<3){g+= "Game Over !!\n\nPlayer 2 win the game !!";}else if(l<3){g+= "Game Over !!\n\nPlayer 1 win the game !!";}if(AC>49)g+= "Too long game ... \n\nDraw !!!";if(m){g+= "The player "+CB.number.toString()+" can't move !! \n\n He lose the game !";}UB=g;KB.window.alert(g);return;} OD( g){var h=new t();qB=g.number;UB='Player '+g.name+' will playing ... ';if(j.w==1){h=UC(j.u,g,false);RC(h.emplacement,g);}else if(j.w==2){h=UC(g,g,false);TC(h,g);}if(h!=null){if(kB(h,g,true,true)){tB(h.emplacement,true);UB='Mill detected ... We go to delete an item !';switch (g.number){case 1:zB.Timer i=new zB.Timer(pB,()=>qC(j.GB));return;break;case 2:zB.Timer i=new zB.Timer(pB,()=>qC(j.BB));return;break;}}else{var i=new zB.Timer(pB,YB);return;}}else{var i=new zB.Timer(pB,YB);return;}} pC( h){for(int g=0;g<gB.length;g++ ){if(gB[g].attributes["data-square"]==h.square&&gB[g].attributes["data-value"]==h.value.toString()){return gB[g];break;}}} ZB( g){return j.k.firstWhere(( h){if(h.square==g.attributes["data-square"]&&h.value.toString()==g.attributes["data-value"]){return true;}else return false;},orElse:(){print('No position founded for the case ...');return new n();});} qC( h){var g=UC(h,h,true);if(g.emplacement!=null){SC(g.emplacement);}else{print('Cannot delete an item : there are only mills !');}YB();} RC( g, h){if(j.w==1)mC++ ;var i=j.k.indexOf(g);var l=pC(g);g.player=h;j.k.removeAt(i);j.k.add(g);if(j.w==1)print('Drop item to : '+g.square+'-'+g.value.toString());l.classes.add(h.name);return;} SC( g){var h=j.k.indexOf(g);var i=pC(g);i.classes.remove(g.player.name);g.player=j.u;j.k.removeAt(h);j.k.add(g);return;} TC( g, h){if(g!=null&&g.s!=null&&g.emplacement!=null){print('Move item from : '+g.s.square+'-'+g.s.value.toString()+' to : '+g.emplacement.square+'-'+g.emplacement.value.toString());var i=new t(0,g.s);if(kB(i,h,true,true)){print('We break a mill ...');tB(i.emplacement,false);}SC(g.s);RC(g.emplacement,h);return;}else{QC(true);return;}} tB( h, i){var g=j.k.indexOf(h);h.isMorris=i;j.k[g]=h;if(OB.player!=null){g=j.k.indexOf(OB);OB.isMorris=i;j.k[g]=OB;}if(PB.player!=null){g=j.k.indexOf(PB);PB.isMorris=i;j.k[g]=PB;}if(QB.player!=null){g=j.k.indexOf(QB);QB.isMorris=i;j.k[g]=QB;}if(RB.player!=null){g=j.k.indexOf(RB);RB.isMorris=i;j.k[g]=RB;}if(QB.player!=null&&RB.player!=null){print('You just make a mill in : '+h.square+'-'+h.value.toString()+' | '+QB.square+'-'+QB.value.toString()+' | '+RB.square+'-'+RB.value.toString());}if(OB.player!=null&&PB.player!=null){print('You just make a mill in : '+h.square+'-'+h.value.toString()+' | '+OB.square+'-'+OB.value.toString()+' | '+PB.square+'-'+PB.value.toString());}} UC( HB, m, SB){iB=SB;var DB=new t();if(j.w==2&&CB.yB)DB=QD(CB);o=new List<t>();if(j.w==1||iB){for(int g=0;g<j.k.length;g++ ){if(j.k[g].player.number==HB.number){if(iB&&j.k[g].isMorris==false){var h=new t(0,j.k[g]);o.add(h);hB=0;VB=false;jB(h,m,true);}else if(!iB){var h=new t(0,j.k[g]);o.add(h);hB=0;VB=false;jB(h,m,true);}}}}else{for(int g=0;g<j.k.length;g++ ){if(j.w==2&&CB.yB){if(j.k[g].player.number==0){var h=new t(0,j.k[g]);h.s=DB.emplacement;o.add(h);hB=0;VB=false;jB(h,m,true);}}else{if(j.k[g].player.number==HB.number){var AB=new t();AB.emplacement=j.k[g];AB.points=0;var p=VC(AB,true);if(p.length>0){for(var q=0;q<p.length;q++ ){if(p[q].player.number==0){var h=new t(0,p[q]);h.s=j.k[g];o.add(h);hB=0;VB=true;XB=h;jB(h,m,false);}}}}}}}var i=new List<t>();var l=0;for(int g=0;g<o.length;g++ ){if(!iB){print('Position : '+o[g].emplacement.square+'-'+o[g].emplacement.value.toString()+' | points : '+o[g].points.toString());if(CB.MB==3){if(o[g].points==l){i.add(o[g]);}else if(o[g].points>l){l=o[g].points;i=new List<t>();i.add(o[g]);}}else{i.add(o[g]);}}else{if(o[g].points==l&&!o[g].emplacement.isMorris){i.add(o[g]);}else if(o[g].points>l&&!o[g].emplacement.isMorris){l=o[g].points;i=new List<t>();i.add(o[g]);}}}return rC(i);} rC( g){if(g.length==1)return g[0];else if(g.length==0){print('Unable to delete/move an item !!');return new t();}var i=new SE.Random();for(var h=g.length-1;h>0;h-- ){var l=i.nextInt(g.length);return g[l];}} jB( l, h, i){PD(l,h,i);kB(l,h,false,i);if(VB&&hB<AD){hB++ ;if(rB.length>0){for(int g=0;g<rB.length;g++ ){var m=new t(0,rB[g]);m.s=XB.emplacement;VB=false;jB(m,h,i);VB=true;}}}} PD( l, p, q){var m=VC(l,q);rB=new List<n>();var g=0;for(int i=0;i<m.length;i++ ){g+= ED;if(m[i].player.number==p.number)g+= CD;else if(m[i].player.number==0){g+= BD;rB.add(m[i]);}else g+= DD;}var h;if(!VB){h=o.indexOf(l);l.points+= g;if(h!=-1){o.removeAt(h);o.add(l);}}else{h=o.indexOf(XB);XB.points+= g;if(h!=-1){o.removeAt(h);o.add(XB);}}} VC( h, l){var i=new List<n>();for(int g=0;g<j.k.length;g++ ){if(h.emplacement.square==j.k[g].square){if(GC(h.emplacement.value,1)==j.k[g].value||FC(h.emplacement.value,1)==j.k[g].value){if(j.w==2&&!l){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square){i.add(j.k[g]);}}else{i.add(j.k[g]);}}}if(h.emplacement.value==1||h.emplacement.value==3||h.emplacement.value==5||h.emplacement.value==7){switch (h.emplacement.square){case 'G':if(j.k[g].square=='M'&&j.k[g].value==h.emplacement.value){if(j.w==2&&!l){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square)i.add(j.k[g]);}else{i.add(j.k[g]);}}break;case 'S':if(j.k[g].square=='M'&&j.k[g].value==h.emplacement.value){if(j.w==2&&!l){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square)i.add(j.k[g]);}else{i.add(j.k[g]);}}break;case 'M':if(j.k[g].square!='M'&&j.k[g].value==h.emplacement.value){if(j.w==2&&!l){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square)i.add(j.k[g]);}else{i.add(j.k[g]);}}break;}}}return i;} kB( h, i, fB, DB){var AB=0;var HB=0;var eB=0;var kC=[0,2,4,6];OB=new n();PB=new n();QB=new n();RB=new n();if(kC.contains(h.emplacement.value)){var m=new List<n>();var q=new List<n>();for(int g=0;g<j.k.length;g++ ){if(j.k[g].square==h.emplacement.square&&(GC(h.emplacement.value,1)==j.k[g].value||(GC(h.emplacement.value,2))==j.k[g].value)){if(j.w==2&&!DB){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square)m.add(j.k[g]);}else{m.add(j.k[g]);}}if(j.k[g].square==h.emplacement.square&&(FC(h.emplacement.value,1)==j.k[g].value||(FC(h.emplacement.value,2))==j.k[g].value)){if(j.w==2&&!DB){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square)q.add(j.k[g]);}else{q.add(j.k[g]);}}}if(m.length==2){if(m[0].player.number!=0&&m[0].player.number==m[1].player.number){if(m[0].player.number==i.number){AB+= BC;if(fB){OB=m[0];PB=m[1];return true;}}else{AB+= CC;}}else if(m[0].player.number==i.number||m[1].player.number==i.number){if((m[0].player.number!=0&&m[0].player.number!=i.number)||(m[1].player.number!=0&&m[1].player.number!=i.number))eB+= EC;else HB+= DC;}}if(q.length==2){if(q[0].player.number!=0&&q[0].player.number==q[1].player.number){if(q[0].player.number==i.number){AB+= BC;if(fB){QB=q[0];RB=q[1];return true;}}else{AB+= CC;}}else if(q[0].player.number==i.number||q[1].player.number==i.number){if((q[0].player.number!=i.number&&q[0].player.number!=0)||(q[1].player.number!=i.number&&q[1].player.number!=0))eB+= EC;else HB+= DC;}}}else{var p=new List<n>();var l=new List<n>();for(int g=0;g<j.k.length;g++ ){if(j.k[g].square==h.emplacement.square){if(GC(h.emplacement.value,1)==j.k[g].value||FC(h.emplacement.value,1)==j.k[g].value){if(j.w==2&&!DB){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square)p.add(j.k[g]);}else{p.add(j.k[g]);}}}else{switch (h.emplacement.square){case 'G':if((j.k[g].square=='M'||j.k[g].square=='S')&&j.k[g].value==h.emplacement.value){if(j.w==2&&!DB){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square)l.add(j.k[g]);}else{l.add(j.k[g]);}}break;case 'S':if((j.k[g].square=='M'||j.k[g].square=='G')&&j.k[g].value==h.emplacement.value){if(j.w==2&&!DB){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square)l.add(j.k[g]);}else{l.add(j.k[g]);}}break;case 'M':if((j.k[g].square=='G'||j.k[g].square=='S')&&j.k[g].value==h.emplacement.value){if(j.w==2&&!DB){if(j.k[g].value!=h.s.value||j.k[g].square!=h.s.square)l.add(j.k[g]);}else{l.add(j.k[g]);}}break;}}}if(p.length==2){if(p[0].player.number!=0&&p[0].player.number==p[1].player.number){if(p[0].player.number==i.number){AB+= BC;if(fB){OB=p[0];PB=p[1];return true;}}else{AB+= CC;}}else if(p[0].player.number==i.number||p[1].player.number==i.number){if((p[0].player.number!=i.number&&p[0].player.number!=0)||(p[1].player.number!=i.number&&p[1].player.number!=0))eB+= EC;else HB+= DC;}}if(l.length==2){if(l[0].player.number!=0&&l[0].player.number==l[1].player.number){if(l[0].player.number==i.number){AB+= BC;if(fB){QB=l[0];RB=l[1];return true;}}else{AB+= CC;}}else if(l[0].player.number==i.number||l[1].player.number==i.number){if((l[0].player.number!=0&&l[0].player.number!=i.number)||(l[1].player.number!=0&&l[1].player.number!=i.number))eB+= EC;else HB+= DC;}}}if(!fB){if(!VB){var SB=o.indexOf(h);h.points+= AB;if(iB){h.points+= HB;h.points-= eB;}if(SB!=-1){o.removeAt(SB);o.add(h);}}else{var SB=o.indexOf(XB);XB.points+= AB;if(SB!=-1){o.removeAt(SB);o.add(XB);}}}else{return false;}} QD( m){o=new List<t>();for(int g=0;g<j.k.length;g++ ){if(j.k[g].player.number==m.number){var l=new t(0,j.k[g]);o.add(l);jB(l,m,true);}}var h=new List<t>();var i=1000;for(int g=0;g<o.length;g++ ){if(CB.MB==3){if(o[g].points==i){h.add(o[g]);}else if(o[g].points<i){i=o[g].points;h=new List<t>();h.add(o[g]);}}else{h.add(o[g]);}}return rC(h);} FC( g, h){if(g==0){return 8-h;}else{return g-h;}} GC( g, h){if(g+h>=8)return 0;else{return g+h;}} RD(){var WE=KB.document.body;var XE,YE,ZE;var aE=new KE(WE);XE=WE.nodes[1].nodes[1].nodes[3].nodes[1].nodes[1].nodes[0];var bE=aE.hC(()=>UB,false);XE.nodes.add(bE);YE=WE.nodes[1].nodes[1].nodes[3].nodes[1].nodes[6].nodes[0];var cE=aE.hC(()=>AC,false);YE.nodes.addAll([new KB.Text('Round : '),cE]);ZE=WE.nodes[1].nodes[1].nodes[3].nodes[1].nodes[11];var dE=aE.hC(()=>yC,false);ZE.nodes.add(dE);aE.iC();aE.insert();}typedef  WB( e);typedef  SD( changes);typedef  lB();typedef  TD();class HC{final oldValue;final newValue;final  changes;HC(this.oldValue,this.newValue,[this.changes]); operator==(g){return g is HC&&oldValue==g.oldValue&&newValue==g.newValue&&changes==g.changes;} get hashCode=>fD(oldValue,newValue,changes); toString(){if(changes!=null)return '#<ChangeNotification to ${newValue}: ${changes}>';return '#<ChangeNotification from ${oldValue} to ${newValue}>';}}class LB{static const bB=1;static const WC=2;static const sC=WC|4;static const tC=WC|8;final  type;final key;final oldValue;final newValue;LB(this.type,this.key,this.oldValue,this.newValue); operator==(g){return g is LB&&type==g.type&&key==g.key&&oldValue==g.oldValue&&newValue==g.newValue;} get hashCode=>gD(type,key,oldValue,newValue); toString(){var g;switch (type){case bB:g='field';break;case WC:g='index';break;case sC:g='insert';break;case tC:g='remove';break;}return '#<ChangeRecord ${g} ${key} from ${oldValue} to ${newValue}>';}} UD(g, i,[ m]){if(g is EB){var h=g;return XC(h,(p){i(new HC(h,h,p));});}var l=new IC(g,i,m);if(!l.eE()){return WD;}return l.fE;} XC( g, i){if(g.oB==null)g.oB=new cC();var h=g.oB.add(i);return h.remove;}class EB{var oB;var nB;final  hashCode= ++EB.VD;static var VD=0;} YC( g)=>g.oB!=null&&g.oB.head!=null; get ZC=>mB!=null; aC( g, h,i)=>mB.gE(g,h,i); bC( g, l,m, h, i){if((l&(LB.sC|LB.tC))==0){if(h==i)return;}if(cB==null){cB=[] ;hD(XD);}if(g.nB==null){g.nB=[] ;cB.add(g);}g.nB.add(new LB(l,m,h,i));} WD(){}var mB;var uC=100;var cB;var dB; XD(){var p=0;while (cB!=null||dB!=null){var l=cB;cB=null;var i=dB;dB=null;if(p++ ==uC){YD(l,i);return;}if(l!=null){for(var h in l){var AB=h.nB;h.nB=null;for(var g=h.oB.head;g!=null;g=g.next){var m=g.value;try {m(AB);}catch (DB,q){uB(DB,q,m,'from ${h}');}}}}if(i!=null){i.forEach((SB,HB){HB.hE();});}}} YD( m, l){var g=[] ;if(m!=null){for(var i in m){var AB=i.nB;g.add('${i} ${AB}');}}if(l!=null){for(var p in l.values){var h=p.hE();if(h!=null)g.add('${p} ${h}');}}cB=null;dB=null;var q='exceeded notifiction limit of ${uC}, possible ' 'circular reference in observer callbacks: ${g.take(10).join(", ")}';bD(q);}class IC{static var ZD=0;final  iE= ++IC.ZD;final  jE;final  kE;final  lE;final  mE=new Map();final  nE=[] ;var oE=false;var pE;IC(this.jE,this.kE,this.lE); toString()=>lE!=null?'<observer ${iE}: ${lE}>':'<observer ${iE}>'; eE(){var h=mB;mB=this;try {pE=jE();if(pE is Iterable&&pE is !List&&pE is !EB){pE=(pE as Iterable).toList();}}catch (g,i){uB(g,i,jE,'from ${this}');pE=null;}mE.forEach(qE);mE.clear();assert(mB==this);mB=h;rE();return nE.length>0;} sE( i){try {kE(i);}catch (g,h){uB(g,h,kE,'from ${this}');}} rE(){var g=pE;if(g is !EB)return;nE.add(XC(g,(h){sE(new HC(g,g,h));}));} gE( p, q,g){var i=mE.putIfAbsent(p,()=>new Map());try {var h=i[g];if(h==null)h=0;i[g]=h|q;}catch (l,m){uB(l,m,g,'hashCode or operator == from ${this}');}} qE( i, l){nE.add(XC(i,(m){if(oE)return;for(var g in m){var h=l[g.key];if(h!=null&&(h&g.type)!=0){oE=true;if(dB==null){dB=new lC.SplayTreeMap();}dB[iE]=this;return;}}}));} fE(){for(var g in nE){g();}oE=false;} hE(){if(!oE)return null;var g=pE;fE();eE();try {if(g==pE)return null;}catch (i,l){uB(i,l,g,'operator == from ${this}');return null;}var h=new HC(g,pE);sE(h);return h;}}typedef  aD( message);var bD=(g)=>print(g);typedef  cD(error,stackTrace,obj, message);var uB=dD; dD(i,g,h, l){print('web_ui.observe: unhandled error calling ${h} ${l}.\n' 'error:\n${i}\n\nstack trace:\n${g}');}class eD{eD();}class IB<JB>{var tE;var uE;var vE;var wE;IB.TE( g,this.vE):wE=g{if(vE!=null)vE.xE++ ;} get next=>uE; get value=>wE;set value( g)=>wE=g; yE( g, h){uE=h;tE=g;if(g!=null)g.uE=this;if(h!=null)h.tE=this;return this;} append( g)=>new IB<JB>.TE(g,vE).yE(this,uE); remove(){if(vE==null)return;vE.xE-- ;if(tE!=null){tE.uE=uE;}else{vE.zE=uE;}if(uE!=null){uE.tE=tE;}else{vE.AF=tE;}uE=null;tE=null;vE=null;}}class cC<JB> extends lC.IterableBase<JB>{var zE;var AF; get length=>xE;var xE=0;cC(){} get head=>zE; add( h){var g=new IB<JB>.TE(h,this);if(AF==null)return zE=AF=g;return AF=g.yE(AF,null);} addLast( g)=>add(g); addAll( g)=>g.forEach(add); get iterator=>new IE<JB>(this);}class IE<JB> implements Iterator<JB>{var BF;var vE;var CF;var DF=-1;IE(this.vE){BF=new List<IB>(vE.length);var h=0;var g=vE.head;while (g!=null){BF[h++ ]=g;g=g.next;}} get current=>CF; moveNext(){do{DF++ ;}while(DF<BF.length&&BF[DF].vE!=vE);if(DF<BF.length){CF=BF[DF].value;return true;}else{CF=null;return false;}}}vB(h,g)=>h.hashCode*31+g.hashCode;fD(h,g,i)=>vB(vB(h,g),i);gD(g,i,h,l)=>vB(vB(g,i),vB(h,l)); hD( h()){var g=new RE.ReceivePort();g.receive((i,l){g.close();h();});g.toSendPort().send(null);} iD(i, g,[ h]){var l=i is eD;if(h==null){h=i.toString();}if(!l&&g is KB.Text){g.text=h;}else{var m=g;g=l?new KB.Element.html(h):new KB.Text(h);m.replaceWith(g);}return g;}abstract class dC{ iC(){} insert(); remove();}class JE extends dC{final exp;final  action;final  isFinal;var KC;JE(this.exp,this.action,this.isFinal); insert(){if(isFinal){action(new HC(null,exp()));}else if(KC!=null){throw new StateError('binding already attached');}else{KC=lD(exp,action,'generic-binding');}} remove(){if(!isFinal){KC();KC=null;}}}class KE extends dC{final  tD;final  children=[] ;final  nodes=[] ;KE(this.tD); hC( h,i){var g=new KB.Text('');children.add(new JE(()=>'${h()}',(l){g=iD(h(),g,l.newValue);},i));return g;} add( g)=>nodes.add(g); addAll( g)=>nodes.addAll(g); iC(){for(var g=0,h=children.length;g<h;g++ ){children[g].iC();}} insert(){for(var g=0,h=children.length;g<h;g++ ){children[g].insert();}} remove(){for(var g=children.length-1;g>=0;g-- ){children[g].remove();}children.clear();}}var vC=false; jD(g, p,[ m]){if(vC)return UD(g,p);if(p==null)return (){};if(eC==null)eC=new cC<wB>();var i;var h=FB.oD;if(g is wC){i=(g as wC).EF;}else if(g is Function){i=g;try {var l=g();if(l is List){h=FB.xB;}else if(l is Iterable){h=FB.xB;i=()=>g().toList();}else if((l is lC.LinkedHashMap)||(l is lC.SplayTreeMap)){h=FB.gC;}else if(l is Map){h=FB.fC;}}catch (AB,HB){print('error: evaluating ${m!=null?m:"<unnamed>"} ' 'watcher threw error (${AB}, ${HB})');}}else if(g is List){i=()=>g;h=FB.xB;}else if(g is Iterable){i=()=>g.toList();h=FB.xB;}else if((g is lC.LinkedHashMap)||(g is lC.SplayTreeMap)){i=()=>g;h=FB.gC;}else if(g is Map){i=()=>g;h=FB.fC;}var q=kD(h,i,p,m);var DB=eC.add(q);return DB.remove;} kD( l, g, i, h){switch (l){case FB.xB:return new LE(g,i,h);case FB.gC:return new PE(g,i,h);case FB.fC:return new ME(g,i,h);default:return new wB(g,i,h);}} lD(h,i,[l]){var m=jD(h,i,l);var g=h;if(g is Function){g=g();}if(g is Iterable&&g is !List){g=g.toList();}i(new HC(null,g));return m;}var eC;class wB{final  jC;final  EF;final  FF;var GF;wB(this.EF,this.FF,this.jC){GF=EF();} toString()=>jC==null?'<unnamed>':jC; HF(g){GF=g;}IF(){try {return EF();}catch (g,h){print('error: evaluating ${this} watcher threw an exception (${g}, ${h})');}return GF;}}typedef  mD<nD>();class wC<nD>{wC();}class LE<nD> extends wB{LE(g, i, h):super(g,i,h){HF(IF());} HF(g){GF=new List<nD>.from(g);}}class ME<NE,OE> extends wB{ME(g, i, h):super(g,i,h){HF(IF());} HF(g){GF=new Map<NE,OE>.from(g);}}class PE<NE,OE> extends wB{PE(g, i, h):super(g,i,h){HF(IF());} HF(g){GF=new lC.LinkedHashMap.from(g);}}class FB{final JF;const FB.UE(this.JF);toString()=>'Enum.${JF}';static const xB=const FB.UE('LIST');static const fC=const FB.UE('HASH_MAP');static const gC=const FB.UE('ORDERED_MAP');static const oD=const FB.UE('OTHER');}