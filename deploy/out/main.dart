import "dart:math" as WD;import "dart:html" as FB;import "dart:isolate" as VD;import "dart:async" as nB;import "dart:collection" as SD;class TD{final  name;const TD(this.name);}class t{var points;var emplacement;var q;t([this.points,this.emplacement]);}class ZC{var j;var u;var BB;var DB;var vB;var w;var GB; GD(){FD();ED();} ED(){var n=new m(0,"G",u,false);var ID=new m(1,"G",u,false);var JD=new m(2,"G",u,false);var KD=new m(3,"G",u,false);var k=new m(4,"G",u,false);var EB=new m(5,"G",u,false);var NB=new m(6,"G",u,false);var g=new m(7,"G",u,false);var XB=new m(0,"M",u,false);var YB=new m(1,"M",u,false);var h=new m(2,"M",u,false);var LD=new m(3,"M",u,false);var MD=new m(4,"M",u,false);var l=new m(5,"M",u,false);var s=new m(6,"M",u,false);var MC=new m(7,"M",u,false);var ND=new m(0,"S",u,false);var p=new m(1,"S",u,false);var OD=new m(2,"S",u,false);var HB=new m(3,"S",u,false);var AB=new m(4,"S",u,false);var PD=new m(5,"S",u,false);var QD=new m(6,"S",u,false);var RD=new m(7,"S",u,false);j=new List<m>();j.add(n);j.add(ID);j.add(JD);j.add(KD);j.add(k);j.add(EB);j.add(NB);j.add(g);j.add(XB);j.add(YB);j.add(h);j.add(LD);j.add(MD);j.add(l);j.add(s);j.add(MC);j.add(ND);j.add(p);j.add(OD);j.add(HB);j.add(AB);j.add(PD);j.add(QD);j.add(RD);} FD(){u=new v(0,true,"neutral");BB=new v(1,true,"khaleesi");DB=new v(2,true,"snow");} HD( g, h){GB=h;print('--------------------------------');if(g==1){BB.isIA=true;BB.GB=3;DB.isIA=true;DB.GB=1;vB=1;print('IA lvl 3 vs IA lvl 1');}else if(g==2){BB.isIA=false;BB.GB=3;DB.isIA=true;DB.GB=3;vB=2;print('Player vs IA lvl 3');}else if(g==3){BB.isIA=false;BB.GB=3;DB.isIA=true;DB.GB=1;vB=3;print('Player vs IA lvl 1');}else{BB.isIA=false;BB.GB=3;DB.isIA=false;DB.GB=3;vB=3;print('Player vs Player');}print('--------------------------------');}}class v{var number;var isIA;var name;var GB=3;var mB=false;v([this.number,this.isIA,this.name]);}class m{var player;var square;var value;var isMorris;m([this.value,this.square,this.player,this.isMorris]);}final UB=new eB();var NC;set OB( g){if(HC(UB)){IC(UB,TB.lB,'message',NC,g);}NC=g;}var OC='';set aC( g){if(HC(UB)){IC(UB,TB.lB,'carefullMessage',OC,g);}OC=g;}var wB=0; get xB{if(tC){uC(UB,TB.lB,'round');}return wB;}set xB( g){if(HC(UB)){IC(UB,TB.lB,'round',wB,g);}wB=g;}const gB=const Duration(seconds:2);final  bC=17;final  cC=2;final  oB=26;final  pB=10;final  dC=2;final  eC=6;final  fC=5;final  gC=1;final  qB=6;final  rB=4;var i;var yB=false;var ZB;var o;var hB=0;var VB=false;var IB;var aB=0;var PC=0;var PB=false;var bB=false;var QB;var iB;var CB;var JB=new m();var KB=new m();var LB=new m();var MB=new m(); main(){OB='Game started ...';i=new ZC();i.GD();i.HD(1,1);hC();} hC(){ZB=FB.queryAll('.playable');ZB.forEach(( g){g.onClick.listen(( h){iC(g);});});print('Game starting ...');i.w=1;xB++ ;if(i.BB.isIA)zB(i.BB);else{CB=i.BB;OB='Your turn : click on a node to drop an item !';}} iC( g){if(!yB){if(hB==0){if(i.w==1){if(!VB)kC(CB,g);else RC(CB,g);return;}else{if(!VB){if(IB!=null){jC(CB,g);}else{QC(CB,g);}}else RC(CB,g);return;}}else{FB.window.alert('Wait for your turn !');return;}}else return;} jC( h, n){var g=SB(n);if(g.square!=null){if(g.player.number==h.number){QC(h,n);}else if(g.player.number==0){var p=new t(0,SB(IB));p.q=SB(IB);if(h.mB){var l=new t(0,g);l.q=SB(IB);DC(l,h);var k=new t(0,g);if(dB(k,h,true,true)){kB(k.emplacement,true);OB='Mill detected ... You can delete an adversary item !';VB=true;jB();}else{RB();}}else{var s=FC(p,true);if(s.length>0){if(s.contains(g)){var l=new t(0,g);l.q=SB(IB);DC(l,h);var k=new t(0,g);if(dB(k,h,true,true)){kB(k.emplacement,true);OB='Mill detected ... You can delete an adversary item !';VB=true;jB();}else{RB();}}}else{print('No possible moves ...');FB.window.alert('No possible moves ...');}}}else{print('Position is owned by an adversary : impossible move');FB.window.alert('Position is owned by an adversary : impossible move');}}else{print('No position !');FB.window.alert('Erreur !');}} QC( k, g){var h=SB(g);if(h.square!=null){if(h.player.number==k.number){if(IB!=null&&IB.attributes["data-square"]==g.attributes["data-square"]&&IB.attributes["data-value"]==g.attributes["data-value"]){jB();}else{jB();g.classes.add("selected");IB=g;}}}else{print('No position !');FB.window.alert('Erreur !');}} jB(){IB=null;FB.queryAll('.playable').forEach(( g){if(g.classes.contains("selected"))g.classes.remove("selected");});} kC( k, l){var g=SB(l);if(g.square!=null){if(g.player.number==0){BC(g,k);var h=new t(0,g);if(dB(h,k,true,true)){kB(h.emplacement,true);OB='Mill detected ... You can delete an adversary item !';VB=true;}else{RB();}}else{print('Position not empty !');FB.window.alert('Please select an empty position');}}else{print('No position !');FB.window.alert('Erreur !');}} RC( h, k){var g=SB(k);if(g.square!=null){if(g.player.number!=0&&g.player.number!=h.number){if(!g.isMorris){CC(g);VB=false;RB();}else{print('Position is on a mill !');FB.window.alert('That item is on a mill : You can\'t delete it !');lC(h);}}else{print('Position is not an adversary !');FB.window.alert('That position isn\'t an adversary !');}}else{print('No position !');FB.window.alert('Erreur !');}} lC( k){var h=0;for(int g=0;g<i.j.length;g++ ){if(i.j[g].player.number!=k.number&&i.j[g].player.number!=0&&!i.j[g].isMorris)h++ ;}if(h==0){FB.window.alert('There is only mill on the game ... You can\'t delete an item !');VB=false;RB();}return;} mC( g){xB++ ;switch (g.number){case 1:if(i.DB.isIA)zB(i.DB);else CB=i.DB;break;case 2:if(i.BB.isIA)zB(i.BB);else CB=i.BB;break;}return;} zB( g){if(!yB){if(g.number==hB||hB==0){CB=g;var h=new nB.Timer(gB,()=>nC(g));}}return;} nC( g){pC(g);return;} RB(){hB=0;OB='Next gamer will play ...';jB();oC();mC(CB);} oC(){if(PC>bC&&i.w!=2){i.w=2;xB=0;print('Game step 2 enclenched ...');}if(i.w>1){var h=0;var k=0;for(int g=0;g<i.j.length;g++ ){if(i.j[g].player.number==1)h++ ;else if(i.j[g].player.number==2)k++ ;}if(h<3||k<3){AC(false);return;}else if(h<4){i.BB.mB=true;}else if(k<4){i.DB.mB=true;}if(xB>49){AC(false);return;}else if(xB>30){aC="After 50 rounds, the game will be over ! Hurry !";}}} AC( n){yB=true;var g="";var k=0;var l=0;for(int h=0;h<i.j.length;h++ ){if(i.j[h].player.number==1)k++ ;else if(i.j[h].player.number==2)l++ ;}if(k<3){g+= "Game Over !!\n\nPlayer 2 win the game !!";}else if(l<3){g+= "Game Over !!\n\nPlayer 1 win the game !!";}if(xB>49)g+= "Too long game ... \n\nDraw !!!";if(n){g+= "The player "+CB.number.toString()+" can't move !! \n\n He lose the game !";}OB=g;FB.window.alert(g);return;} pC( g){var h=new t();hB=g.number;OB='Player '+g.name+' will playing ... ';if(i.w==1){h=EC(i.u,g,false);BC(h.emplacement,g);}else if(i.w==2){h=EC(g,g,false);DC(h,g);}if(h!=null){if(dB(h,g,true,true)){kB(h.emplacement,true);OB='Mill detected ... We go to delete an item !';switch (g.number){case 1:nB.Timer k=new nB.Timer(gB,()=>TC(i.DB));return;break;case 2:nB.Timer k=new nB.Timer(gB,()=>TC(i.BB));return;break;}}else{var k=new nB.Timer(gB,RB);return;}}else{var k=new nB.Timer(gB,RB);return;}} SC( h){for(int g=0;g<ZB.length;g++ ){if(ZB[g].attributes["data-square"]==h.square&&ZB[g].attributes["data-value"]==h.value.toString()){return ZB[g];break;}}} SB( g){return i.j.firstWhere(( h){if(h.square==g.attributes["data-square"]&&h.value.toString()==g.attributes["data-value"]){return true;}else return false;},orElse:(){print('No position founded for the case ...');return new m();});} TC( h){var g=EC(h,h,true);if(g.emplacement!=null){CC(g.emplacement);}else{print('Cannot delete an item : there are only mills !');}RB();} BC( g, h){if(i.w==1)PC++ ;var k=i.j.indexOf(g);var l=SC(g);g.player=h;i.j.removeAt(k);i.j.add(g);if(i.w==1)print('Drop item to : '+g.square+'-'+g.value.toString());l.classes.add(h.name);return;} CC( g){var h=i.j.indexOf(g);var k=SC(g);k.classes.remove(g.player.name);g.player=i.u;i.j.removeAt(h);i.j.add(g);return;} DC( g, h){if(g!=null&&g.q!=null&&g.emplacement!=null){print('Move item from : '+g.q.square+'-'+g.q.value.toString()+' to : '+g.emplacement.square+'-'+g.emplacement.value.toString());var k=new t(0,g.q);if(dB(k,h,true,true)){print('We break a mill ...');kB(k.emplacement,false);}CC(g.q);BC(g.emplacement,h);return;}else{AC(true);return;}} kB( h, k){var g=i.j.indexOf(h);h.isMorris=k;i.j[g]=h;if(JB.player!=null){g=i.j.indexOf(JB);JB.isMorris=k;i.j[g]=JB;}if(KB.player!=null){g=i.j.indexOf(KB);KB.isMorris=k;i.j[g]=KB;}if(LB.player!=null){g=i.j.indexOf(LB);LB.isMorris=k;i.j[g]=LB;}if(MB.player!=null){g=i.j.indexOf(MB);MB.isMorris=k;i.j[g]=MB;}if(LB.player!=null&&MB.player!=null){print('You just make a mill in : '+h.square+'-'+h.value.toString()+' | '+LB.square+'-'+LB.value.toString()+' | '+MB.square+'-'+MB.value.toString());}if(JB.player!=null&&KB.player!=null){print('You just make a mill in : '+h.square+'-'+h.value.toString()+' | '+JB.square+'-'+JB.value.toString()+' | '+KB.square+'-'+KB.value.toString());}} EC( HB, n, NB){bB=NB;var EB=new t();if(i.w==2&&CB.mB)EB=rC(CB);o=new List<t>();if(i.w==1||bB){for(int g=0;g<i.j.length;g++ ){if(i.j[g].player.number==HB.number){if(bB&&i.j[g].isMorris==false){var h=new t(0,i.j[g]);o.add(h);aB=0;PB=false;cB(h,n,true);}else if(!bB){var h=new t(0,i.j[g]);o.add(h);aB=0;PB=false;cB(h,n,true);}}}}else{for(int g=0;g<i.j.length;g++ ){if(i.w==2&&CB.mB){if(i.j[g].player.number==0){var h=new t(0,i.j[g]);h.q=EB.emplacement;o.add(h);aB=0;PB=false;cB(h,n,true);}}else{if(i.j[g].player.number==HB.number){var AB=new t();AB.emplacement=i.j[g];AB.points=0;var p=FC(AB,true);if(p.length>0){for(var s=0;s<p.length;s++ ){if(p[s].player.number==0){var h=new t(0,p[s]);h.q=i.j[g];o.add(h);aB=0;PB=true;QB=h;cB(h,n,false);}}}}}}}var k=new List<t>();var l=0;for(int g=0;g<o.length;g++ ){if(!bB){print('Position : '+o[g].emplacement.square+'-'+o[g].emplacement.value.toString()+' | points : '+o[g].points.toString());if(CB.GB==3){if(o[g].points==l){k.add(o[g]);}else if(o[g].points>l){l=o[g].points;k=new List<t>();k.add(o[g]);}}else{k.add(o[g]);}}else{if(o[g].points==l&&!o[g].emplacement.isMorris){k.add(o[g]);}else if(o[g].points>l&&!o[g].emplacement.isMorris){l=o[g].points;k=new List<t>();k.add(o[g]);}}}return UC(k);} UC( g){if(g.length==1)return g[0];else if(g.length==0){print('Unable to delete/move an item !!');return new t();}var k=new WD.Random();for(var h=g.length-1;h>0;h-- ){var l=k.nextInt(g.length);return g[l];}} cB( l, h, k){qC(l,h,k);dB(l,h,false,k);if(PB&&aB<cC){aB++ ;if(iB.length>0){for(int g=0;g<iB.length;g++ ){var n=new t(0,iB[g]);n.q=QB.emplacement;PB=false;cB(n,h,k);PB=true;}}}} qC( l, p, s){var n=FC(l,s);iB=new List<m>();var g=0;for(int k=0;k<n.length;k++ ){g+= gC;if(n[k].player.number==p.number)g+= eC;else if(n[k].player.number==0){g+= dC;iB.add(n[k]);}else g+= fC;}var h;if(!PB){h=o.indexOf(l);l.points+= g;if(h!=-1){o.removeAt(h);o.add(l);}}else{h=o.indexOf(QB);QB.points+= g;if(h!=-1){o.removeAt(h);o.add(QB);}}} FC( h, l){var k=new List<m>();for(int g=0;g<i.j.length;g++ ){if(h.emplacement.square==i.j[g].square){if(tB(h.emplacement.value,1)==i.j[g].value||sB(h.emplacement.value,1)==i.j[g].value){if(i.w==2&&!l){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square){k.add(i.j[g]);}}else{k.add(i.j[g]);}}}if(h.emplacement.value==1||h.emplacement.value==3||h.emplacement.value==5||h.emplacement.value==7){switch (h.emplacement.square){case 'G':if(i.j[g].square=='M'&&i.j[g].value==h.emplacement.value){if(i.w==2&&!l){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square)k.add(i.j[g]);}else{k.add(i.j[g]);}}break;case 'S':if(i.j[g].square=='M'&&i.j[g].value==h.emplacement.value){if(i.w==2&&!l){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square)k.add(i.j[g]);}else{k.add(i.j[g]);}}break;case 'M':if(i.j[g].square!='M'&&i.j[g].value==h.emplacement.value){if(i.w==2&&!l){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square)k.add(i.j[g]);}else{k.add(i.j[g]);}}break;}}}return k;} dB( h, k, YB, EB){var AB=0;var HB=0;var XB=0;var MC=[0,2,4,6];JB=new m();KB=new m();LB=new m();MB=new m();if(MC.contains(h.emplacement.value)){var n=new List<m>();var s=new List<m>();for(int g=0;g<i.j.length;g++ ){if(i.j[g].square==h.emplacement.square&&(tB(h.emplacement.value,1)==i.j[g].value||(tB(h.emplacement.value,2))==i.j[g].value)){if(i.w==2&&!EB){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square)n.add(i.j[g]);}else{n.add(i.j[g]);}}if(i.j[g].square==h.emplacement.square&&(sB(h.emplacement.value,1)==i.j[g].value||(sB(h.emplacement.value,2))==i.j[g].value)){if(i.w==2&&!EB){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square)s.add(i.j[g]);}else{s.add(i.j[g]);}}}if(n.length==2){if(n[0].player.number!=0&&n[0].player.number==n[1].player.number){if(n[0].player.number==k.number){AB+= oB;if(YB){JB=n[0];KB=n[1];return true;}}else{AB+= pB;}}else if(n[0].player.number==k.number||n[1].player.number==k.number){if((n[0].player.number!=0&&n[0].player.number!=k.number)||(n[1].player.number!=0&&n[1].player.number!=k.number))XB+= rB;else HB+= qB;}}if(s.length==2){if(s[0].player.number!=0&&s[0].player.number==s[1].player.number){if(s[0].player.number==k.number){AB+= oB;if(YB){LB=s[0];MB=s[1];return true;}}else{AB+= pB;}}else if(s[0].player.number==k.number||s[1].player.number==k.number){if((s[0].player.number!=k.number&&s[0].player.number!=0)||(s[1].player.number!=k.number&&s[1].player.number!=0))XB+= rB;else HB+= qB;}}}else{var p=new List<m>();var l=new List<m>();for(int g=0;g<i.j.length;g++ ){if(i.j[g].square==h.emplacement.square){if(tB(h.emplacement.value,1)==i.j[g].value||sB(h.emplacement.value,1)==i.j[g].value){if(i.w==2&&!EB){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square)p.add(i.j[g]);}else{p.add(i.j[g]);}}}else{switch (h.emplacement.square){case 'G':if((i.j[g].square=='M'||i.j[g].square=='S')&&i.j[g].value==h.emplacement.value){if(i.w==2&&!EB){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square)l.add(i.j[g]);}else{l.add(i.j[g]);}}break;case 'S':if((i.j[g].square=='M'||i.j[g].square=='G')&&i.j[g].value==h.emplacement.value){if(i.w==2&&!EB){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square)l.add(i.j[g]);}else{l.add(i.j[g]);}}break;case 'M':if((i.j[g].square=='G'||i.j[g].square=='S')&&i.j[g].value==h.emplacement.value){if(i.w==2&&!EB){if(i.j[g].value!=h.q.value||i.j[g].square!=h.q.square)l.add(i.j[g]);}else{l.add(i.j[g]);}}break;}}}if(p.length==2){if(p[0].player.number!=0&&p[0].player.number==p[1].player.number){if(p[0].player.number==k.number){AB+= oB;if(YB){JB=p[0];KB=p[1];return true;}}else{AB+= pB;}}else if(p[0].player.number==k.number||p[1].player.number==k.number){if((p[0].player.number!=k.number&&p[0].player.number!=0)||(p[1].player.number!=k.number&&p[1].player.number!=0))XB+= rB;else HB+= qB;}}if(l.length==2){if(l[0].player.number!=0&&l[0].player.number==l[1].player.number){if(l[0].player.number==k.number){AB+= oB;if(YB){LB=l[0];MB=l[1];return true;}}else{AB+= pB;}}else if(l[0].player.number==k.number||l[1].player.number==k.number){if((l[0].player.number!=0&&l[0].player.number!=k.number)||(l[1].player.number!=0&&l[1].player.number!=k.number))XB+= rB;else HB+= qB;}}}if(!YB){if(!PB){var NB=o.indexOf(h);h.points+= AB;if(bB){h.points+= HB;h.points-= XB;}if(NB!=-1){o.removeAt(NB);o.add(h);}}else{var NB=o.indexOf(QB);QB.points+= AB;if(NB!=-1){o.removeAt(NB);o.add(QB);}}}else{return false;}} rC( n){o=new List<t>();for(int g=0;g<i.j.length;g++ ){if(i.j[g].player.number==n.number){var l=new t(0,i.j[g]);o.add(l);cB(l,n,true);}}var h=new List<t>();var k=1000;for(int g=0;g<o.length;g++ ){if(CB.GB==3){if(o[g].points==k){h.add(o[g]);}else if(o[g].points<k){k=o[g].points;h=new List<t>();h.add(o[g]);}}else{h.add(o[g]);}}return UC(h);} sB( g, h){if(g==0){return 8-h;}else{return g-h;}} tB( g, h){if(g+h>=8)return 0;else{return g+h;}}class TB{static const lB=1;static const GC=2;static const VC=GC|4;static const WC=GC|8;final  type;final key;final oldValue;final newValue;TB(this.type,this.key,this.oldValue,this.newValue); operator==(g){return g is TB&&type==g.type&&key==g.key&&oldValue==g.oldValue&&newValue==g.newValue;} get hashCode=>CD(type,key,oldValue,newValue); toString(){var g;switch (type){case lB:g='field';break;case GC:g='index';break;case VC:g='insert';break;case WC:g='remove';break;}return '#<ChangeRecord ${g} ${key} from ${oldValue} to ${newValue}>';}}class eB{var LC;var fB;final  hashCode= ++eB.sC;static var sC=0;} HC( g)=>g.LC!=null&&g.LC.head!=null; get tC=>XC!=null; uC( g, h,k)=>XC.YD(g,h,k); IC( g, l,n, h, k){if((l&(TB.VC|TB.WC))==0){if(h==k)return;}if(WB==null){WB=[] ;DD(vC);}if(g.fB==null){g.fB=[] ;WB.add(g);}g.fB.add(new TB(l,n,h,k));}var XC;var YC=100;var WB;var uB; vC(){var p=0;while (WB!=null||uB!=null){var l=WB;WB=null;var k=uB;uB=null;if(p++ ==YC){wC(l,k);return;}if(l!=null){for(var h in l){var AB=h.fB;h.fB=null;for(var g=h.LC.head;g!=null;g=g.next){var n=g.value;try {n(AB);}catch (EB,s){AD(EB,s,n,'from ${h}');}}}}if(k!=null){k.forEach((NB,HB){HB.ZD();});}}} wC( n, l){var g=[] ;if(n!=null){for(var k in n){var AB=k.fB;g.add('${k} ${AB}');}}if(l!=null){for(var p in l.values){var h=p.ZD();if(h!=null)g.add('${p} ${h}');}}WB=null;uB=null;var s='exceeded notifiction limit of ${YC}, possible ' 'circular reference in observer callbacks: ${g.take(10).join(", ")}';yC(s);}class JC{JC();}typedef  xC( message);var yC=(g)=>print(g);typedef  zC(error,stackTrace,obj, message);var AD=BD; BD(k,g,h, l){print('web_ui.observe: unhandled error calling ${h} ${l}.\n' 'error:\n${k}\n\nstack trace:\n${g}');}KC(h,g)=>h.hashCode*31+g.hashCode;CD(g,k,h,l)=>KC(KC(g,k),KC(h,l)); DD( h()){var g=new VD.ReceivePort();g.receive((k,l){g.close();h();});g.toSendPort().send(null);}